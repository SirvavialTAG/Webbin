<!DOCTYPE html>
<html>
<head>
    <title>Список автомобилей</title>
    <style>
        .filter-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .filter-container > div {
             flex: 1 1 150px; /*  занимает место и позволяет переносить на новую строку*/
        }

        .filter-container select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .sort-container {
            margin-bottom: 20px; /* Отступ от фильтров */
            display: flex; /* выравнивание элемента сортировки */
            align-items: center;
        }
        .sort-container label {
            margin-right: 10px;
            white-space: nowrap; /* предотвращает перенос слов в label */
        }
    </style>
</head>


<body>
    <h1>Список машин</h1>

    <form method="get">
        <div class="filter-container">
              <div>
                <select name="brand">
                    <option value="">Марка авто</option>
                    {% for brand in available_brands %}
                        <option value="{{ brand }}" {% if request.GET.brand == brand %} selected {% endif %}>{{ brand }}</option>
                    {% endfor %}
                </select>
            </div>

            <div>
                <select name="model">
                    <option value="">Модель авто</option>
                    {% for model in available_models %}
                        <option value="{{ model }}" {% if request.GET.model == model %} selected {% endif %}>{{ model }}</option>
                    {% endfor %}
                </select>
            </div>

            <div style="display: flex; gap: 10px;">
                <select name="year_from" id="year_from">
                    <option value="">Год от</option>
                    {% for year in available_years %}
                        <option value="{{ year }}" {% if request.GET.year_from == year|stringformat:"s" %}selected{% endif %}>{{ year }}</option>
                    {% endfor %}
                </select>
                 <select name="year_to" id="year_to">
                    <option value="">Год до</option>
                    {% for year in available_years %}
                        <option value="{{ year }}" {% if request.GET.year_to == year|stringformat:"s" %}selected{% endif %}>{{ year }}</option>
                    {% endfor %}
                </select>
            </div>

            <div style="display: flex; gap: 10px;">
                <select name="mileage_from" id="mileage_from">
                    <option value="">Пробег от</option>
                    {% for mileage in available_mileages %}
                        <option value="{{ mileage }}" {% if request.GET.mileage_from == mileage|stringformat:"s" %}selected{% endif %}>{{ mileage }}</option>
                    {% endfor %}
                </select>
                <select name="mileage_to" id="mileage_to">
                    <option value="">Пробег до</option>
                    {% for mileage in available_mileages %}
                        <option value="{{ mileage }}" {% if request.GET.mileage_to == mileage|stringformat:"s" %}selected{% endif %}>{{ mileage }}</option>
                    {% endfor %}
                </select>
            </div>

             <div style="display: flex; gap: 10px;">
                <select name="volume_from" id="volume_from">
                    <option value="">Объем от</option>
                    {% for volume in available_volumes %}
                        <option value="{{ volume }}" {% if request.GET.volume_from == volume|stringformat:"s" %}selected{% endif %}>{{ volume }}</option>
                    {% endfor %}
                </select>
                <select name="volume_to" id="volume_to">
                     <option value="">Объем до</option>
                    {% for volume in available_volumes %}
                        <option value="{{ volume }}" {% if request.GET.volume_to == volume|stringformat:"s" %}selected{% endif %}>{{ volume }}</option>
                    {% endfor %}
                </select>
            </div>

           <div>
                <select name="drive" id="drive">
                    <option value="">Привод</option>
                    {% for drive_option in available_drives %}
                        <option value="{{ drive_option }}" {% if request.GET.drive == drive_option %}selected{% endif %}>{{ drive_option }}</option>
                    {% endfor %}
                </select>
            </div>

            <div>
                <select name="transmission" id="transmission">
                    <option value="">Тип КПП</option>
                    {% for transmission in available_transmissions %}
                        <option value="{{ transmission }}" {% if request.GET.transmission == transmission %}selected{% endif %}>{{ transmission }}</option>
                    {% endfor %}
                </select>
            </div>

           <div>
                <select name="color" id="color">
                    <option value="">Цвет</option>
                    {% for color in available_colors %}
                        <option value="{{ color }}" {% if request.GET.color == color %}selected{% endif %}>{{ color }}</option>
                    {% endfor %}
                </select>
            </div>

               <input type="submit" value="Применить фильтры">
                <button type="button" onclick="window.location.href=window.location.pathname">Сбросить фильтры</button>
        </div>
    <div class="sort-container">
         <label for="sort">Сортировка:</label>
        <select name="sort" id="sort" onchange="this.form.submit()">
            <option value="" {% if not sort_option %}selected{% endif %}>Сортировка</option>
            <option value="price_asc" {% if sort_option == "price_asc" %}selected{% endif %}>Стоимость: по возрастанию</option>
            <option value="price_desc" {% if sort_option == "price_desc" %}selected{% endif %}>Стоимость: по убыванию</option>
            <option value="year_desc" {% if sort_option == "year_desc" %}selected{% endif %}>Год: по убыванию</option>
            <option value="year_asc" {% if sort_option == "year_asc" %}selected{% endif %}>Год: по возрастанию</option>
            <option value="mileage_asc" {% if sort_option == "mileage_asc" %}selected{% endif %}>Пробег: по возрастанию</option>
            <option value="mileage_desc" {% if sort_option == "mileage_desc" %}selected{% endif %}>Пробег: по убыванию</option>
            <option value="volume_asc" {% if sort_option == "volume_asc" %}selected{% endif %}>Объём: по возрастанию</option>
            <option value="volume_desc" {% if sort_option == "volume_desc" %}selected{% endif %}>Объём: по убыванию</option>
        </select>
       <noscript><input type="submit" value="Отсортировать"></noscript>
      </div>
    </form>

    <ul>
        {% for car in cars_page %}
            <li>{{ car.brand_country.brand }} {{ car.model }} ({{ car.year }}), Пробег: {{ car.mileage }}, Цена: {{ car.price }}, Объем: {{ car.engine_volume }}</li>
        {% endfor %}
    </ul>

    <div class="pagination">
     <span class="step-links">
         {% if cars_page.has_previous %}
            <a href="?page=1{% if sort_option %}&sort={{ sort_option }}{% endif %}{% with request.GET.copy as get_params %}{% for key, value in get_params.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}{% endwith %}">« first</a>
            <a href="?page={{ cars_page.previous_page_number }}{% if sort_option %}&sort={{ sort_option }}{% endif %}{% with request.GET.copy as get_params %}{% for key, value in get_params.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}{% endwith %}">previous</a>
        {% endif %}

         <span class="current">
             Page {{ cars_page.number }} of {{ cars_page.paginator.num_pages }}.
         </span>

         {% if cars_page.has_next %}
             <a href="?page={{ cars_page.next_page_number }}{% if sort_option %}&sort={{ sort_option }}{% endif %}{% with request.GET.copy as get_params %}{% for key, value in get_params.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}{% endwith %}">next</a>
            <a href="?page={{ cars_page.paginator.num_pages }}{% if sort_option %}&sort={{ sort_option }}{% endif %}{% with request.GET.copy as get_params %}{% for key, value in get_params.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}{% endwith %}">last »</a>
        {% endif %}
     </span>
    </div>
</body>
</html>